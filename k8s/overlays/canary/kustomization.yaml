apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: ecommerce

resources:
- ../../base

patchesStrategicMerge:
- ecommerce-canary-deployment.yaml
- mongodb-deployment-patch.yaml
- hpa-patch.yaml

replicas:
- name: ecommerce-app
  count: 1
- name: mongodb
  count: 1

images:
- name: dashing-ecommerce
  newName: your-dockerhub-username/dashing-ecommerce
  newTag: v1.1.0-canary

configMapGenerator:
- name: ecommerce-config
  literals:
  - NODE_ENV=production
  - NEXTAUTH_URL=https://canary.ecommerce.example.com
  - MONGODB_URI=mongodb://mongodb-service:27017/ecommerce_canary
